# dungeon-api
## Методы API
Для работы с API используются исключительно **POST** запросы. Всего доступно 3 вида запросов: start, move, fight
### start
[localhost:8081/Dungeon/start](http://localhost:8081/Dungeon/start)
Используется для начала игры. Перезапускает текущую игру, даже если она не начата. В теле запроса передаётся описание подземелья, например:
```json
{
    "n": 5,
    "rooms": [
        "empty",
        "chest common",
        "monster 300",
        "chest rare",
        "monster 101"
    ],
    "routes": [
        [1],
        [0, 2],
        [1, 3, 4],
        [2],
        [2]
    ],
    "start": 0,
    "finish": 4
}
```
Здесь **n** - количество комнат в подземелье, массив **rooms** - массив описывающий каждую из комнат (empty, monster {hp}, chest {common|rare|epic}), массив **routes** - описывает в какие комнаты можно поасть из i-ой комнаты, **start** - начальная комната, **finish** - конечная. Возвращает описание стартовой комнаты в виде::
```json
{
    "location": 0,
    "status": "empty room",
    "currentScore": 0,
    "availableMoves": [
        1
    ]
}
```
### move
[localhost:8081/Dungeon/move](http://localhost:8081/Dungeon/move)
Перемещение в доступную комнату. На вход требует индекс комнаты:
```json
{
"target": 4
}
```
Если комната доступна из текущей, то возвращает описание новой комнаты и премещает игрока в неё, иначе просто возвращает описание текущей комнаты. Если же перемещение достигает финишной комнаты, возвращает общуюю информацию о прохождении в виде:
```json
{
    "status": "Dungeon Is Over",
    "finalScore": 422,
    "shortestRouteToExit": [
        0,
        1,
        2,
        4
    ]
}
```
После чего записывает информацию о счёте в базу данных в таблицу results.
### fight
[localhost:8081/Dungeon/fight](http://localhost:8081/Dungeon/fight)
Не требует входных данных. Если в комнате находится монстр, наносит ему урон и возвращает описание комнаты, если монстра нет - ничего не делает и просто возварщает описание текущей комнаты.
## Общая информация
API работает на localhost на порту **8081**. Для тестирование использовался **xampp** и **Postman**. База данных **dungeon** из единственной таблици **results** разработана в СУБД **MySQL**. Начало и процесс игры происходят в одной сессии. В Postman этого можно добиться с помощью cookie вида **sessionid=omuxrmt33mnetsfirxi2sdsfh4j1c2kv111**.
